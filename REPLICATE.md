# Replicating experiment results
This document provides detailed instructions to replicate the results of the controlled experiments presented in our paper "Change And Cover: Last-Mile, Pull Request-Based Regression Test Augmentation" published at ICSE '26.

> Note: Ensure you followed [README.md](/README.md) to setup environment.

> Note: To fully replicate the experiments which contains 145 benchmark PRs, ensure your Docker is installed on disk with at least 1TB free space. You can partition the experiments into smaller batches, or only evaluate some projects, if needed.

> Note: If you only want to evaluate results, instead of running ChaCo, skip to **[Use existing data](#use-existing-data)**.

### Benchmark PRs
The benchmark PRs are stored in JSON files located in the `config/benchmark/` directory. `rq_full.json` contains all 145 PRs used in our experiments. `rq_ablation.json` contains the PRs used in the ablation study.

### RQ1: Full ChaCo
To replicate the results of RQ1 (Full ChaCo), follow these steps:

1. Build the docker images by running: `bash eval/rq1_setup.sh`. This step can take several days and significant disk space.

2. Generate and evaluate tests by running: `python -m approach.evaluate_generator_on_benchmark --config config/rq1.yaml` The tests will be stored in `data/test_augmentation/rq1/{project}/test_cases/chaco_full/`.

3. Evaluate by running 
```bash
cd eval
# Repeat for each project
papermill example.ipynb eval/rq1_results_{PROJ}.ipynb \
  -p CONFIG_FILE "config/benchmark/rq_full.json" \
  -p REPO_NAME "{OWNER}/{PROJ}" \
  -p ARTIFACT_FOLDER "../data/test_augmentation/rq1/{PROJ}" \
  -p GENERATOR_NAME_KEY "Full ChaCo" \
  -p FOLDER_WITH_TESTS "chaco_full"
```

### RQ2.1: Qualitative Analysis
The reviewed test cases are stored under `pr-test-reviews/reviews`. The review guideline is [REVIEW.md](/pr-test-reviews/REVIEW.md). To generate the heatmap of test quality scores, use the notebook `pr-test-reviews/Qualitative_Analysis.ipynb`.

### RQ2.2: Test Submissions
The results of test submissions are stored in [here](/pr-test-reviews/test_acceptability.csv).

### RQ3: Ablation Study
To replicate the results of RQ3 (Ablation Study), follow these steps:
1. Generate and evaluate tests by running: `bash eval/rq3.sh`. The tests generated by each ablated variant of ChaCo will be stored in `data/test_augmentation/rq3/{project}/test_cases/{ablated_variants}`.
2. Similarly, evaluate by running this. It will evaluate all ablated variants in one notebook.
```bash
cd eval
# Repeat for each project
papermill ablation.ipynb rq3_results_{PROJ}.ipynb \
    -p CONFIG_FILE "config/benchmark/rq_ablation.json" \
    -p REPO_NAME "{OWNER}/{PROJ}" \
    -p ARTIFACT_FOLDER "../data/test_augmentation/rq3/{PROJ}"
```
## Use existing data
If you want to evaluate the results using existing data without running ChaCo, follow these steps:
1. Download the raw data from [figshare](https://doi.org/10.6084/m9.figshare.31022089) and by running: `tar -xzf <downloaded_file> -C data/test_augmentation/`. Then `data/test_augmentation/rq` will contain all the data for RQ1 and RQ3. Tests are stored under `.../rq/{project}/test_cases/{generator}`.
2. Use the evaluation notebooks:
```bash
cd eval
# RQ1: Repeat for each project
papermill example.ipynb eval/rq1_results_{PROJ}.ipynb \
  -p CONFIG_FILE "config/benchmark/rq_full.json" \
  -p REPO_NAME "{OWNER}/{PROJ}" \
  -p ARTIFACT_FOLDER "../data/test_augmentation/rq1/{PROJ}" \
  -p GENERATOR_NAME_KEY "Full ChaCo" \
  -p FOLDER_WITH_TESTS "chaco_full"

# RQ3: Repeat for each project
papermill ablation.ipynb rq3_results_{PROJ}.ipynb \
    -p CONFIG_FILE "config/benchmark/rq_ablation.json" \
    -p REPO_NAME "{OWNER}/{PROJ}" \
    -p ARTIFACT_FOLDER "../data/test_augmentation/rq/{PROJ}"
```